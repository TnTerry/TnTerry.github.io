---
title: '旋转位置编码 (RoPE)'
date: 2025-03-30
excerpt: |
  RoPE原理与实现
permalink: /posts/2025/03/RoPE/
tags:
  - 技术
  - LLM
  - Embedding
  - RoPE
---

[旋转位置编码 (Rotary Position Embedding, RoPE)](https://arxiv.org/pdf/2104.09864) 是一种用于增强Transformer模型中位置编码的技术。目前，主流的大语言模型大多采用RoPE作为位置编码方法。

# RoPE的原理

## 基础概念

输入序列是由 \\( N \\) 个token组成的序列，其中 \\( w_i \\) 是第 \\( i \\) 个token：

$$
\mathbb{S}_N = \{w_i \}_{i=1}^N \in \mathbb{R}^{N \times d}
$$

我们将输入序列的每个token嵌入到一个 \\( d \\) 维的向量空间中，我们可以得到embedding序列：

$$
\mathbb{E}_N = \{x_i \}_{i=1}^N \in \mathbb{R}^{N \times d}
$$

其中 \\(x_i \\) 是第 \\( i \\) 个token的嵌入向量，且 \\( x_i \in \mathbb{R}^d \\) 是 \\( d \\) 维的向量。

在计算self-attention之前，我们将位置信息与embedding进行融合，并将它们分别转化为 \\( q \\) , \\( k \\) 和 \\( v \\) 向量。

$$
\begin{aligned}
q_m &= f_q(x_m, m) \\
k_n &= f_k(x_n, m) \\
v_n &= f_v(x_n, m)
\end{aligned}
$$